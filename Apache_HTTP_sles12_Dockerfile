# Docker file for building Apache http Server on sles12

FROM sles12

# Owner of the docker file
MAINTAINER  LoZ Open Source Ecosystem (https://www.ibm.com/developerworks/community/groups/community/lozopensource)

# Install build dependencies
RUN zypper install -y git \
	openssl \
	gcc \
	libtool \
	autoconf \
	make \
	pcre \
	pcre-devel \
	libxml2 \
	libxml2-devel \
	libexpat-devel


# Get the source code from git
RUN git clone https://github.com/apache/httpd.git

# Change the working directory to source folder
WORKDIR httpd

# Install the dependecy package apr from source
RUN cd srclib && git clone https://github.com/apache/apr.git && cd apr && ./buildconf && ./configure && make && make install

# Build and install httpd
RUN ./buildconf && ./configure --prefix=/usr/local && make && make install

# Add the server name to configuration file
RUN echo "ServerName localhost" >> /usr/local/conf/httpd.conf

EXPOSE 80

# Copy the configuration file to /etc/ folder
RUN mkdir -p /etc/httpd && cp /usr/local/conf/httpd.conf /etc/httpd/

