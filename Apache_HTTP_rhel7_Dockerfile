# Docker file for building Apache http Server on rhel7

FROM rhel7

MAINTAINER  LoZ Open Source Ecosystem (https://www.ibm.com/developerworks/community/groups/community/lozopensource)

# Install build dependencies
RUN yum install -y git \
	openssl \
	gcc \
	libtool \
	autoconf \
	make \
	pcre \
	pcre-devel \
	libxml2 \
	libxml2-devel \
	expat \
	expat-devel

# Re-install ca-certificates for openssl framework
RUN yum reinstall -y ca-certificates

# Get source
RUN git clone https://github.com/apache/httpd.git

WORKDIR httpd

RUN cd srclib && git clone https://github.com/apache/apr.git && cd apr && ./buildconf && ./configure && make && make install

RUN ./buildconf && ./configure --prefix=/usr/local && make && make install

RUN echo "ServerName localhost" >> /usr/local/conf/httpd.conf

EXPOSE 80

RUN mkdir -p /etc/httpd && cp /usr/local/conf/httpd.conf /etc/httpd/

